name: Clean Sync to Account B

on:
  push:
    branches:
      - main  # 或者您的主分支名（比如 master）
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source
        uses: actions/checkout@v4
        with:
          # 只拉取最后一层提交，不拉取历史记录
          fetch-depth: 1
          persist-credentials: false

      - name: Push to B (Clean)
        run: |
          # 1. 初始化 Git 配置
          git config --global user.name "Backup Bot"
          git config --global user.email "bot@example.com"
          
          # 2. 构造 B 仓库地址
          REMOTE_REPO="https://x-access-token:${{ secrets.B_TOKEN }}@github.com/nnksetu/nnksetu.git"
          
          # 3. 强制覆盖 B 账号的 main 分支
          # 这会删除 B 账号原有的历史，只保留 A 账号当前的最新内容
          git push --force "$REMOTE_REPO" main:main
