name: Pure Content Backup

on:
  push:
    branches:
      - main  # 确认 A 账号是 main 分支
  workflow_dispatch:

jobs:
  backup-content:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: Re-initialize and Push
        run: |
          # 1. 彻底清除本地 Git 历史记录，只留纯文件
          rm -rf .git
          
          # 2. 重新初始化为一个全新的仓库
          git init
          git config user.name "Backup Bot"
          git config user.email "bot@example.com"
          
          # 3. 添加所有文件（包含你的 index.html 等）
          git add .
          git commit -m "Pure content backup $(date +'%Y-%m-%d %H:%M:%S')"
          
          # 4. 强制推送到 B 账号
          # 链接确认：https://github.com/nnksetu/nnksetu.git
          REMOTE_REPO="https://x-access-token:${{ secrets.B_TOKEN }}@github.com/nnksetu/nnksetu.git"
          
          # 强制推送到 B 的 main 分支
          git push --force "$REMOTE_REPO" master:main || git push --force "$REMOTE_REPO" main:main
