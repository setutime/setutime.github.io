name: Pure Content Backup

on:
  push:
    branches:
      - '*'
  workflow_dispatch:

jobs:
  backup-content:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: Re-initialize and Push
        run: |
          # 1. 彻底切断旧的历史记录，避免敏感信息拦截
          rm -rf .git
          
          # 2. 重新初始化本地仓库
          git init
          git config user.name "Backup Bot"
          git config user.email "bot@example.com"
          
          # 3. 提交当前干净的内容 
          git add .
          git commit -m "Pure content backup $(date +'%Y-%m-%d %H:%M:%S')"
          
          # 4. 强制推送至 B 账号
          # 确保你使用的是已开启 workflow 权限的 B_TOKEN
          REMOTE_REPO="https://x-access-token:${{ secrets.B_TOKEN }}@github.com/nnksetu/nnksetu.git"
          
          # 这里的 HEAD:main 意思是将本地当前内容强制推送到 B 账号的 main 分支
          git push --force "$REMOTE_REPO" HEAD:main
